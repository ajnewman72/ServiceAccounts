<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_transform_entry">
    <sys_transform_entry action="INSERT_OR_UPDATE">
        <choice_action>create</choice_action>
        <coalesce>true</coalesce>
        <coalesce_case_sensitive>false</coalesce_case_sensitive>
        <coalesce_empty_fields>false</coalesce_empty_fields>
        <date_format>yyyy-MM-dd HH:mm:ss</date_format>
        <map display_value="lloy_serviceaccountpermission_tmap">e346ce2a93c69610879df0e48aba108c</map>
        <reference_value_field/>
        <source_field>[Script]</source_field>
        <source_script><![CDATA[answer = (function transformEntry(source) {
    // Get the server name from the source record
    var serverName = source.u_server_name;

    // Check if the server name field is defined and not null
    if (serverName) {
        // Extract the server name without the domain
        var serverNameWithoutDomain = serverName.split('.')[0];

        // Query the cmdb_ci_server table for a matching record with the full FQDN
        var serverGR = new GlideRecord('cmdb_ci_server');
        serverGR.addQuery('name', serverName);
        serverGR.addQuery('operational_status', '1'); // '1' is the value for operational
        serverGR.addNotNullQuery('due_date');
        serverGR.query();

        // If a matching record is found with the full FQDN, set the Server field
        if (serverGR.next()) {
            // Uncomment if needed
            // map.coalesce = true;
            return serverGR.sys_id;
        } else {
            // Use a different variable for the second query
            var serverGR2 = new GlideRecord('cmdb_ci_server');
            serverGR2.addQuery('name', serverNameWithoutDomain);
            serverGR2.addQuery('operational_status', '1'); // '1' is the value for operational
            serverGR2.addNotNullQuery('due_date');
            serverGR2.query();

            // If a matching record is found with the server name without the domain, set the Server field
            if (serverGR2.next()) {
                // Uncomment if needed
                // map.coalesce = true;
                return serverGR2.sys_id;
            } else {
                // Handle the case where no matching record is found
                gs.info('No matching server found for: ' + serverName);
                return null; // Explicitly return null
            }
        }
    } else {
        // Handle the case where the server name field is undefined or null
        gs.info('Server name field is undefined or null');
        return null; // Explicitly return null
    }
})(source);
]]></source_script>
        <source_table>x_llol_service_acc_lloy_serviceaccountpermission_impset</source_table>
        <sys_class_name>sys_transform_entry</sys_class_name>
        <sys_created_by>sup_newmanan</sys_created_by>
        <sys_created_on>2024-11-26 14:57:23</sys_created_on>
        <sys_id>7b96c2aa93c69610879df0e48aba1078</sys_id>
        <sys_mod_count>12</sys_mod_count>
        <sys_name>[Script]</sys_name>
        <sys_package display_value="Service Accounts" source="x_llol_service_acc">cfccdb1293281a10879df0e48aba10ef</sys_package>
        <sys_policy/>
        <sys_scope display_value="Service Accounts">cfccdb1293281a10879df0e48aba10ef</sys_scope>
        <sys_update_name>sys_transform_entry_7b96c2aa93c69610879df0e48aba1078</sys_update_name>
        <sys_updated_by>sup_newmanan</sys_updated_by>
        <sys_updated_on>2024-11-28 14:10:45</sys_updated_on>
        <target_field>server_name</target_field>
        <target_table>x_llol_service_acc_permissions</target_table>
        <use_source_script>true</use_source_script>
    </sys_transform_entry>
    <sys_es_latest_script action="INSERT_OR_UPDATE">
        <id>7b96c2aa93c69610879df0e48aba1078</id>
        <sys_created_by>sup_newmanan</sys_created_by>
        <sys_created_on>2024-11-26 15:06:22</sys_created_on>
        <sys_id>5ba84a2e93c69610879df0e48aba1084</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>sup_newmanan</sys_updated_by>
        <sys_updated_on>2024-11-26 15:06:22</sys_updated_on>
        <table>sys_transform_entry</table>
        <use_es_latest>true</use_es_latest>
    </sys_es_latest_script>
</record_update>
